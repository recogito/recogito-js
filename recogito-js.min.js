!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Recogito",[],e):"object"==typeof exports?exports.Recogito=e():t.Recogito=e()}(window,(function(){return function(t){function e(e){for(var o,a,c=e[0],u=e[1],l=e[2],f=0,d=[];f<c.length;f++)a=c[f],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&d.push(r[a][0]),r[a]=0;for(o in u)Object.prototype.hasOwnProperty.call(u,o)&&(t[o]=u[o]);for(s&&s(e);d.length;)d.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],o=!0,c=1;c<n.length;c++){var u=n[c];0!==r[u]&&(o=!1)}o&&(i.splice(e--,1),t=a(a.s=n[0]))}return t}var o={},r={0:0},i=[];function a(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=o,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(n,o,function(e){return t[e]}.bind(null,o));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var c=window.webpackJsonpRecogito=window.webpackJsonpRecogito||[],u=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var s=u;return i.push([56,1]),n()}({52:function(t,e,n){var o=n(14),r=n(53);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var i={insert:"head",singleton:!1},a=(o(r,i),r.locals?r.locals:{});t.exports=a},53:function(t,e,n){(e=n(15)(!1)).push([t.i,".r6o-drawing{cursor:none}.r6o-relations-layer.readonly .handle rect{pointer-events:none}.r6o-relations-layer{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}.r6o-relations-layer circle{stroke:#515151;stroke-width:0.4;fill:#3f3f3f}.r6o-relations-layer path{stroke:#595959;stroke-linecap:round;stroke-linejoin:round;fill:transparent}.r6o-relations-layer path.connection{stroke-width:1.6;stroke-dasharray:2,3}.r6o-relations-layer path.arrow{stroke-width:1.8;fill:#7f7f7f}.r6o-relations-layer .handle rect{stroke-width:1;stroke:#595959;fill:#fff;pointer-events:auto;cursor:pointer}.r6o-relations-layer .handle text{font-size:10px}.r6o-relations-layer .hover{stroke:rgba(63,63,63,0.9);stroke-width:1.4;fill:transparent}\n",""]),t.exports=e},54:function(t,e,n){var o=n(14),r=n(55);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var i={insert:"head",singleton:!1},a=(o(r,i),r.locals?r.locals:{});t.exports=a},55:function(t,e,n){(e=n(15)(!1)).push([t.i,".r6o-btn{background-color:#4483c4;border:1px solid #4483c4;box-sizing:border-box;color:#fff;cursor:pointer;display:inline-block;font-size:14px;margin:0;outline:none;text-decoration:none;white-space:nowrap;padding:6px 18px;min-width:70px;vertical-align:middle;-webkit-border-radius:2px;-khtml-border-radius:2px;-moz-border-radius:2px;border-radius:2px}.r6o-btn *{vertical-align:middle}.r6o-btn .icon{margin-right:4px}.r6o-btn:disabled{border-color:#a3c2e2 !important;background-color:#a3c2e2 !important}.r6o-btn:hover{background-color:#4f92d7;border-color:#4f92d7}.r6o-btn.outline{border:1px solid #4483c4;color:#4483c4;background-color:transparent;text-shadow:none}.r6o-annotation{background-color:#ffa50033;border-bottom:2px solid orange;cursor:pointer}.r6o-selection{background-color:#cfcfffa1;cursor:pointer}.r6o-editable-text{padding:8px 10px;max-height:120px;overflow:auto;outline:none;min-height:3em;font-size:14px}.r6o-editable-text:empty:not(:focus):before{content:attr(data-placeholder);color:#c2c2c2}.r6o-widget.comment{font-size:14px;min-height:3em;background-color:#fff;position:relative}.r6o-widget.comment .arrow-down{position:absolute;top:5px;right:5px;height:20px;width:20px;line-height:14px;font-size:18px;background-color:#fff;text-align:center;text-rendering:auto;-webkit-font-smoothing:antialiased;border:1px solid #e5e5e5;top:9px;right:9px;cursor:pointer;-webkit-border-radius:1px;-khtml-border-radius:1px;-moz-border-radius:1px;border-radius:1px}.r6o-widget.comment .arrow-down::before{content:'\\2304'}.r6o-widget.comment .arrow-down.menu-open{border-color:#4483c4}.r6o-widget.comment .comment-dropdown-menu{position:absolute;top:32px;right:8px;background-color:#fff;border:1px solid #e5e5e5;list-style-type:none;margin:0;padding:5px 0;z-index:9999;-webkit-box-shadow:0 2px 4px rgba(0,0,0,0.2);-moz-box-shadow:0 2px 4px rgba(0,0,0,0.2);box-shadow:0 2px 4px rgba(0,0,0,0.2)}.r6o-widget.comment .comment-dropdown-menu li{padding:0 15px;cursor:pointer}.r6o-widget.comment .comment-dropdown-menu li:hover{background-color:#ecf0f1}.r6o-widget.comment.editable{background-color:#ecf0f1}.tags{background-color:#ecf0f1;border-bottom:1px solid #e5e5e5;padding:1px 3px}.tags ul,.tags li{padding:0;margin:0;display:inline}.tags li{display:inline-block;margin:1px 1px 1px 0;padding:0;vertical-align:middle;overflow:hidden;font-size:12px;background-color:#fff;border:1px solid #d6d7d9;cursor:pointer;position:relative;line-height:180%;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-border-radius:2px;-khtml-border-radius:2px;-moz-border-radius:2px;border-radius:2px;-webkit-box-shadow:0 0 4px rgba(0,0,0,0.1);-moz-box-shadow:0 0 4px rgba(0,0,0,0.1);box-shadow:0 0 4px rgba(0,0,0,0.1)}.tags li .label{padding:2px 8px;display:inline-block}.tags li .delete-wrapper{display:inline-block;padding:2px 0;color:#fff;width:0;height:100%;background-color:#4483c4;vertical-align:top}.tags li .delete-wrapper .delete{padding:2px 6px}.tags li .delete-wrapper .delete .icon{height:11px;padding-bottom:1px}.tags li .delete-enter-active{width:24px;transition:width 200ms}.tags li .delete-enter-done{width:24px}.tags li .delete-exit{width:24px}.tags li .delete-exit-active{width:0;transition:width 200ms}.tags input{padding:0 3px;min-width:80px;outline:none;border:none;line-height:170%;background-color:transparent;color:#3f3f3f}.tags input::-webkit-input-placeholder{color:#c2c2c2}.tags input::-moz-placeholder{color:#c2c2c2}.tags input:-moz-placeholder{color:#c2c2c2}.tags input:-ms-input-placeholder{color:#c2c2c2}.type-selector{display:flex;border-bottom:1px solid #e5e5e5}.type-selector .type{flex:1;text-align:center;padding:7px;font-size:14px}.type-selector .type{cursor:pointer;border-right:1px solid #e5e5e5}.type-selector .type:last-child{border-right:none}.type-selector .type:hover{background-color:#f5f7f7}.type-selector .icon{margin:0 3px 1px 0;height:13px}.r6o-editor{position:absolute;z-index:99999;margin-top:18px;margin-left:-14px;width:400px;color:#3f3f3f}.r6o-editor .arrow{position:absolute;overflow:hidden;top:-12px;left:12px;width:28px;height:12px}.r6o-editor .arrow:after{content:'';position:absolute;top:5px;left:5px;width:18px;height:18px;background-color:#fff;-webkit-backface-visibility:hidden;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);-o-transform:rotate(45deg);transform:rotate(45deg)}.r6o-editor .inner{background-color:#fff;-webkit-border-radius:2px;-khtml-border-radius:2px;-moz-border-radius:2px;border-radius:2px;-webkit-box-shadow:2px 2px 42px rgba(0,0,0,0.4);-moz-box-shadow:2px 2px 42px rgba(0,0,0,0.4);box-shadow:2px 2px 42px rgba(0,0,0,0.4)}.r6o-editor .inner .r6o-widget:first-child{-webkit-border-top-left-radius:2px;-webkit-border-top-right-radius:2px;-khtml-border-radius-topleft:2px;-khtml-border-radius-topright:2px;-moz-border-radius-topleft:2px;-moz-border-radius-topright:2px;border-top-left-radius:2px;border-top-right-radius:2px}.r6o-editor .inner .r6o-widget{border-bottom:1px solid #d6d7d9}.r6o-editor .footer{text-align:right;padding:8px 0}.r6o-editor .footer .r6o-btn{margin-right:8px}.r6o-editor.align-right{margin-left:8px}.r6o-editor.align-right .arrow{left:auto;right:12px}.r6o-editor.align-bottom{margin-bottom:14px}.r6o-editor.align-bottom .arrow{top:auto;bottom:-12px}.r6o-editor.align-bottom .arrow::after{top:-11px;box-shadow:none}.r6o-relation-editor{position:absolute;-webkit-box-shadow:0 1px 14px rgba(0,0,0,0.4);-moz-box-shadow:0 1px 14px rgba(0,0,0,0.4);box-shadow:0 1px 14px rgba(0,0,0,0.4);-webkit-border-radius:3px;-khtml-border-radius:3px;-moz-border-radius:3px;border-radius:3px;transform:translate(-50%, -50%);background-color:#fff}.r6o-relation-editor *{line-height:31px;box-sizing:border-box}.r6o-relation-editor .input{height:34px;display:block;padding:1px 6px;margin-right:68px;font-size:15px;min-width:80px;outline:none;background-color:#fff;cursor:text;-webkit-border-top-left-radius:3px;-webkit-border-bottom-left-radius:3px;-khtml-border-radius-topleft:3px;-khtml-border-radius-bottomleft:3px;-moz-border-radius-topleft:3px;-moz-border-radius-bottomleft:3px;border-top-left-radius:3px;border-bottom-left-radius:3px}.r6o-relation-editor .input:empty:before{content:attr(data-placeholder);color:#aeb0b4}.r6o-relation-editor .buttons{position:absolute;display:inline-flex;top:0;right:0}.r6o-relation-editor .buttons span{height:34px;display:inline-block;width:34px;text-align:center;font-size:14px;cursor:pointer;padding:1px 0}.r6o-relation-editor .buttons .delete{background-color:#fff;color:#3f3f3f;border-left:1px solid #e5e5e5}.r6o-relation-editor .buttons .delete:hover{background-color:#f6f6f6}.r6o-relation-editor .buttons .ok{background-color:#4483c4;color:#fff;-webkit-border-top-right-radius:3px;-webkit-border-bottom-right-radius:3px;-khtml-border-radius-topright:3px;-khtml-border-radius-bottomright:3px;-moz-border-radius-topright:3px;-moz-border-radius-bottomright:3px;border-top-right-radius:3px;border-bottom-right-radius:3px}.r6o-relation-editor .buttons .ok:hover{background-color:#4f92d7}.icon{font-size:14px;font-family:FontAwesome}.noselect{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}\n",""]),t.exports=e},56:function(t,e,n){"use strict";n.r(e),n.d(e,"init",(function(){return We}));var o=n(0),r=n.n(o),i=n(16),a=n.n(i),c=n(17),u=n.n(c),l=n(18),s=n.n(l),f=function(t,e,n){var o=t.offsetLeft,r=t.offsetTop,i=window,a=i.scrollX,c=i.scrollY;e.className="r6o-editor";var u=n.x,l=n.y,s=n.height,f=n.top,d=n.right;e.style.top="".concat(l+s+c-r,"px"),e.style.left="".concat(u+a-o,"px");var p=e.getBoundingClientRect();if(p.right>window.innerWidth&&(e.classList.add("align-right"),e.style.left="".concat(d-p.width+a-o,"px")),p.bottom>window.innerHeight){var h=f+c,b=t.getBoundingClientRect(),y=b.height+b.top+c;e.classList.add("align-bottom"),e.style.top="auto",e.style.bottom="".concat(y-h,"px")}},d=n(58);function p(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],o=!0,r=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(o=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(t){r=!0,i=t}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var b=function(t){var e=p(Object(o.useState)(!1),2),n=e[0],i=e[1],a=p(Object(o.useState)(""),2),c=a[0],u=a[1],l=t.annotation?t.annotation.bodies.filter((function(t){return"tagging"===t.purpose})):[],s=function(t){return function(e){i(n!==t&&t)}},f=function(e){return function(n){n.stopPropagation(),t.onRemoveBody(e)}};return r.a.createElement("div",{className:"tags"},r.a.createElement("ul",null,l.map((function(t){return r.a.createElement("li",{key:t.value,onClick:s(t.value)},r.a.createElement("span",{className:"label"},t.value),r.a.createElement(d.a,{in:n===t.value,timeout:200,classNames:"delete"},r.a.createElement("span",{className:"delete-wrapper",onClick:f(t)},r.a.createElement("span",{className:"delete"},r.a.createElement("span",{className:"icon"},"ï€”")))))}))),r.a.createElement("input",{type:"text",value:c,onChange:function(t){return u(t.target.value)},onKeyDown:function(e){13===e.which&&(t.onAppendBody({type:"TextualBody",purpose:"tagging",value:c.trim()}),u(""))},placeholder:"Add tag..."}))};var y=function(t){var e=Object(o.useRef)();return function(t,e){var n=function(n){t.current&&!t.current.contains(event.target)&&e()};Object(o.useEffect)((function(){return document.addEventListener("mousedown",n),function(){return document.removeEventListener("mousedown",n)}}))}(e,(function(){return t.onClickOutside()})),r.a.createElement("ul",{ref:e,className:"comment-dropdown-menu"},r.a.createElement("li",{onClick:t.onEdit},"Edit"),r.a.createElement("li",{onClick:t.onDelete},"Delete"))},m=n(3),g=n.n(m);function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function w(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function x(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function E(t,e){return!e||"object"!==v(e)&&"function"!=typeof e?O(t):e}function O(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function A(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function S(t){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function C(t,e){return(C=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function j(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var _=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&C(t,e)}(c,t);var e,n,o,i,a=(e=c,function(){var t,n=S(e);if(A()){var o=S(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return E(this,t)});function c(){var t;w(this,c);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return j(O(t=a.call.apply(a,[this].concat(n))),"onKeyDown",(function(e){13===e.which&&e.ctrlKey&&t.props.onSaveAndClose()})),j(O(t),"onRender",(function(e){e&&t.props.editable&&e.focus()})),t}return n=c,(o=[{key:"render",value:function(){return r.a.createElement(g.a,{innerRef:this.onRender,className:"r6o-editable-text",html:this.props.content,"data-placeholder":this.props.placeholder||"Add a comment...",disabled:!this.props.editable,onChange:this.props.onChange,onKeyDown:this.onKeyDown})}}])&&x(n.prototype,o),i&&x(n,i),c}(o.Component);function k(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function R(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function P(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],o=!0,r=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(o=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(t){r=!0,i=t}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return D(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var N=function(t){var e=P(Object(o.useState)(!1),2),n=e[0],i=e[1],a=P(Object(o.useState)(!1),2),c=a[0],u=a[1];return t.readOnly?r.a.createElement("div",{className:"r6o-widget comment"},t.body.value):r.a.createElement("div",{className:n?"r6o-widget comment editable":"r6o-widget comment"},r.a.createElement(_,{editable:n,content:t.body.value,onChange:function(e){t.onUpdate(t.body,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?k(Object(n),!0).forEach((function(e){R(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},t.body,{value:e.target.value}))},onSaveAndClose:t.onSaveAndClose}),r.a.createElement("div",{className:c?"icon arrow-down menu-open":"icon arrow-down",onClick:function(){return u(!c)}}),c&&r.a.createElement(y,{onEdit:function(t){i(!0),u(!1)},onDelete:function(e){t.onDelete(t.body),u(!1)},onClickOutside:function(){return u(!1)}}))};function M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function T(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach((function(e){B(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function B(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var L=function(t){return"TextualBody"===t.type&&(!t.hasOwnProperty("purpose")||"commenting"===t.purpose||"replying"===t.purpose)},I=function(t){var e,n,o=t.annotation?t.annotation.bodies.filter(L):[],i=o.filter((function(t){return!t.draft})),a=(e=o.find((function(t){return t.draft})),n=i.length>0,e||{type:"TextualBody",value:"",purpose:n?"replying":"commenting",draft:!0});return r.a.createElement(r.a.Fragment,null,i.map((function(e,n){return r.a.createElement(N,{key:n,readOnly:t.readOnly,body:e,onUpdate:t.onUpdateBody,onDelete:t.onRemoveBody,onSaveAndClose:t.onSaveAndClose})})),!t.readOnly&&t.annotation&&r.a.createElement("div",{className:"r6o-widget comment editable"},r.a.createElement(_,{content:a.value,editable:!0,placeholder:i.length>0?"Add a reply...":"Add a comment...",onChange:function(e){var n=a.value.trim(),o=e.target.value.trim();0===n.length&&o.length>0?t.onAppendBody(T({},a,{value:o})):n.length>0&&0===o.length?t.onRemoveBody(a):t.onUpdateBody(a,T({},a,{value:o}))},onSaveAndClose:function(){return t.onSaveAndClose()}})))};function U(t,e){if(null==t)return{};var n,o,r=function(t,e){if(null==t)return{};var n,o,r={},i=Object.keys(t);for(o=0;o<i.length;o++)n=i[o],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(o=0;o<i.length;o++)n=i[o],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function z(t){return function(t){if(Array.isArray(t))return X(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||q(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],o=!0,r=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(o=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(t){r=!0,i=t}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}return n}(t,e)||q(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function q(t,e){if(t){if("string"==typeof t)return X(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(t,e):void 0}}function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var Y=function(t){var e=H(Object(o.useState)(),2),n=e[0],i=e[1],a=Object(o.useRef)();Object(o.useEffect)((function(){i(t.annotation),a.current&&f(t.containerEl,a.current,t.bounds)}),[t.annotation]);var c=function(t){return i(n.clone({body:[].concat(z(n.bodies),[t])}))},u=function(t,e){return i(n.clone({body:n.bodies.map((function(n){return n===t?e:n}))}))},l=function(t){return i(n.clone({body:n.bodies.filter((function(e){return e!==t}))}))},s=function(e){var o=function(t){return t.clone({body:t.bodies.map((function(t){t.draft;return U(t,["draft"])}))})};0===n.bodies.length?n.isSelection?t.onCancel():t.onAnnotationDeleted(t.annotation):n.isSelection?t.onAnnotationCreated(o(n).toAnnotation()):t.onAnnotationUpdated(o(n),t.annotation)};return r.a.createElement("div",{ref:a,className:"r6o-editor"},r.a.createElement("div",{className:"arrow"}),r.a.createElement("div",{className:"inner"},r.a.Children.map(t.children,(function(t){return r.a.cloneElement(t,{annotation:n,onAppendBody:c,onUpdateBody:u,onRemoveBody:l,onSaveAndClose:s})})),t.readOnly?r.a.createElement("div",{className:"footer"},r.a.createElement("button",{className:"r6o-btn",onClick:t.onCancel},"Close")):r.a.createElement("div",{className:"footer"},r.a.createElement("button",{className:"r6o-btn outline",onClick:t.onCancel},"Cancel"),r.a.createElement("button",{className:"r6o-btn ",onClick:s},"Ok"))))};function W(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function F(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?W(Object(n),!0).forEach((function(e){$(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function K(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function $(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var V=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),$(this,"clone",(function(e){return new t(F({},n._annotation,{},e))})),$(this,"selector",(function(t){return n._annotation.target.selector&&n._annotation.target.selector.find((function(e){return e.type===t}))})),this._annotation=e}var e,n,o;return e=t,(n=[{key:"isEqual",value:function(t){return!(!t||this._annotation!==t._annotation&&(!this._annotation.id||!t._annotation.id||this._annotation.id!==t._annotation.id))}},{key:"id",get:function(){return this._annotation.id}},{key:"type",get:function(){return this._annotation.type}},{key:"motivation",get:function(){return this._annotation.motivation}},{key:"body",get:function(){return this._annotation.body}},{key:"target",get:function(){return this._annotation.target}},{key:"bodies",get:function(){return Array.isArray(this._annotation.body)?this._annotation.body:[this._annotation.body]},set:function(t){this._annotation.body=t}},{key:"targets",get:function(){return Array.isArray(this._annotation.target)?this._annotation.target:[this._annotation.target]}},{key:"quote",get:function(){return this.selector("TextQuoteSelector").exact}},{key:"start",get:function(){return this.selector("TextPositionSelector").start}},{key:"end",get:function(){return this.selector("TextPositionSelector").end}}])&&K(e.prototype,n),o&&K(e,o),t}();function Q(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],o=!0,r=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(o=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(t){r=!0,i=t}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}return n}(t,e)||J(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(t,e){if(t){if("string"==typeof t)return G(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?G(t,e):void 0}}function G(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function Z(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function tt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}$(V,"create",(function(t){return new V(F({},{"@context":"http://www.w3.org/ns/anno.jsonld",type:"Annotation",body:[]},{},t))}));var et=function(){function t(e,n){var o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),tt(this,"init",(function(t){t.filter((function(t){return t.selector("TextPositionSelector")})).forEach((function(t){return o._addAnnotation(t)}))})),tt(this,"_addAnnotation",(function(t){var e=Q(o.charOffsetsToDOMPosition([t.start,t.end]),2),n=e[0],r=e[1],i=document.createRange();i.setStart(n.node,n.offset),i.setEnd(r.node,r.offset);var a=o.wrapRange(i);o.applyStyles(t,a),o.bindAnnotation(t,a)})),tt(this,"_findAnnotationSpans",(function(t){var e=document.querySelectorAll(".r6o-annotation");return Array.prototype.slice.call(e).filter((function(e){return e.annotation.isEqual(t)}))})),tt(this,"getAllAnnotations",(function(){var t=document.querySelectorAll(".r6o-annotation");return Array.prototype.slice.call(t).map((function(t){return t.annotation}))})),tt(this,"addOrUpdateAnnotation",(function(t,e){var n,r=o._findAnnotationSpans(t),i=e?o._findAnnotationSpans(e):[],a=(n=r.concat(i),Array.from(new Set(n)));a.length>0?(o._unwrapHighlightings(a),o.el.normalize(),o._addAnnotation(t)):o._addAnnotation(t)})),tt(this,"removeAnnotation",(function(t){var e=o._findAnnotationSpans(t);e&&(o._unwrapHighlightings(e),o.el.normalize())})),tt(this,"applyStyles",(function(t,e){var n=o.formatter?o.formatter(t):"";e.forEach((function(t){return t.className="r6o-annotation ".concat(n).trim()}))})),tt(this,"bindAnnotation",(function(t,e){e.forEach((function(e){e.annotation=t,t.id&&(e.dataset.id=t.id)}))})),tt(this,"walkTextNodes",(function(t,e,n){var r,i=n||[],a=!0;if((r=0,i.forEach((function(t){r+=t.textContent.length})),r)>e)return!1;for(3===t.nodeType&&i.push(t),t=t.firstChild;t&&a;)a=o.walkTextNodes(t,e,i),t=t.nextSibling;return i})),tt(this,"charOffsetsToDOMPosition",(function(t){var e,n=Math.max.apply(null,t),r=(e=0,o.walkTextNodes(o.el,n).map((function(t){var n=t.textContent.length,o={node:t,start:e,end:e+n};return e+=n,o})));return o.calculateDomPositionWithin(r,t)})),tt(this,"textNodesBetween",(function(t,e,n){var r,i,a,c=((a=document.createRange()).setStart(n,0),a.setEnd(e,e.textContent.length),a.toString().length),u=o.walkTextNodes(n,c),l=[],s=u.length,f=!1;for(i=0;i<s;i++)(r=u[i])===e&&(f=!1),f&&l.push(r),r===t&&(f=!0);return l})),tt(this,"calculateDomPositionWithin",(function(t,e){var n=[];return t.forEach((function(t,o){return e.forEach((function(e,o){e>=t.start&&e<=t.end&&((n.length>0&&n[n.length-1].charOffset)!==e&&n.push({charOffset:e,node:t.node,offset:e-t.start}))})),n.length<e.length})),n})),tt(this,"wrapRange",(function(t,e){var n=e||o.el,r=function(t){var e=document.createElement("SPAN");return t.surroundContents(e),e};if(t.startContainer===t.endContainer)return[r(t)];var i=o.textNodesBetween(t.startContainer,t.endContainer,n),a=document.createRange();a.selectNodeContents(t.startContainer),a.setStart(t.startContainer,t.startOffset);var c=r(a),u=document.createRange();u.selectNode(t.endContainer),u.setEnd(t.endContainer,t.endOffset);var l=r(u),s=i.reverse().map((function(t){var e=document.createElement("SPAN");return t.parentNode.insertBefore(e,t),e.appendChild(t),e}));return[c].concat(s,[l])})),tt(this,"getAnnotationsAt",(function(t){return function(t){return t.sort((function(t,e){return t.quote.length-e.quote.length}))}(function t(e,n){var o=n||[],r=e.parentNode;return o.push(e.annotation),r.classList.contains("r6o-annotation")?t(r,o):o}(t))})),this.el=e,this.formatter=n}var e,n,o;return e=t,(n=[{key:"_unwrapHighlightings",value:function(t){var e,n=function(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=J(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r,i=!0,a=!1;return{s:function(){o=t[Symbol.iterator]()},n:function(){var t=o.next();return i=t.done,t},e:function(t){a=!0,r=t},f:function(){try{i||null==o.return||o.return()}finally{if(a)throw r}}}}(t);try{for(n.s();!(e=n.n()).done;){var o=e.value,r=o.parentNode;r.insertBefore(document.createTextNode(o.textContent),o),r.removeChild(o)}}catch(t){n.e(t)}finally{n.f()}}}])&&Z(e.prototype,n),o&&Z(e,o),t}(),nt=n(20),ot=n.n(nt);function rt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function it(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?rt(Object(n),!0).forEach((function(e){ct(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function at(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function ct(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ut=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ct(this,"clone",(function(e){var o=new t(n._stub.target.selector.map((function(t){return it({},t)})));return e&&(o._stub=it({},o._stub,{},e)),o})),ct(this,"selector",(function(t){return n._stub.target.selector.find((function(e){return e.type===t}))})),ct(this,"toAnnotation",(function(){var t=Object.assign({},n._stub,{"@context":"http://www.w3.org/ns/anno.jsonld",type:"Annotation",id:ot()()});return new V(t)})),this._stub={type:"Selection",body:[],target:{selector:e}}}var e,n,o;return e=t,(n=[{key:"type",get:function(){return this._stub.type}},{key:"body",get:function(){return this._stub.body}},{key:"target",get:function(){return this._stub.target}},{key:"bodies",get:function(){return this._stub.body}},{key:"quote",get:function(){return this.selector("TextQuoteSelector").exact}},{key:"isSelection",get:function(){return!0}}])&&at(e.prototype,n),o&&at(e,o),t}(),lt=n(2),st=n.n(lt);function ft(t){return(ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function pt(t,e){return!e||"object"!==ft(e)&&"function"!=typeof e?ht(t):e}function ht(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function bt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function yt(t){return(yt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function mt(t,e){return(mt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function gt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var vt="ontouchstart"in window||navigator.maxTouchPoints>0,wt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&mt(t,e)}(a,t);var e,n,o,r,i=(e=a,function(){var t,n=yt(e);if(bt()){var o=yt(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return pt(this,t)});function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),gt(ht(n=i.call(this)),"_onMouseDown",(function(t){n.clearSelection()})),gt(ht(n),"_onMouseUp",(function(t){if(n.isEnabled){var e=getSelection();if(e.isCollapsed){var o=t.target.closest(".r6o-annotation");o?n.emit("select",{selection:n.highlighter.getAnnotationsAt(o)[0],clientRect:o.getBoundingClientRect()}):n.emit("select",{})}else{var r=function(t){for(var e=t.toString(),n=0,o=0;" "===e.substring(0,1);)n+=1,e=e.substring(1);for(;" "===e.substring(e.length-1);)o+=1,e=e.substring(0,e.length-1);return n>0&&t.setStart(t.startContainer,t.startOffset+n),o>0&&t.setEnd(t.endContainer,t.endOffset-o),t}(e.getRangeAt(0)),i=function(t,e){var n=document.createRange();n.setStart(e,0),n.setEnd(t.startContainer,t.startOffset);var o=t.toString(),r=n.toString().length;return new ut([{type:"TextQuoteSelector",exact:o},{type:"TextPositionSelector",start:r,end:r+o.length}])}(r,n.el),a=r.getBoundingClientRect();n.highlighter.wrapRange(r).forEach((function(t){return t.className="selection"})),n._clearNativeSelection(),n.emit("select",{selection:i,clientRect:a})}}})),gt(ht(n),"_clearNativeSelection",(function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()})),gt(ht(n),"clearSelection",(function(){n._currentSelection=null;var t=Array.prototype.slice.call(n.el.querySelectorAll(".selection"));t&&t.forEach((function(t){var e=t.parentNode;e.insertBefore(document.createTextNode(t.textContent),t),e.removeChild(t)})),n.el.normalize()})),n.el=t,n.highlighter=e,n.isEnabled=!0,t.addEventListener("mousedown",n._onMouseDown),t.addEventListener("mouseup",n._onMouseUp),vt&&function(t,e){var n,o,r=function(){o&&(e(o),n=null,o=null)};t.addEventListener("touchstart",(function(t){n||(o=t,n=setTimeout(r,1e3))})),document.addEventListener("selectionchange",(function(t){n&&(clearTimeout(n),n=setTimeout(r,1500))}))}(t,n._onMouseUp),n}return n=a,(o=[{key:"enabled",get:function(){return this.isEnabled},set:function(t){this.isEnabled=t}}])&&dt(n.prototype,o),r&&dt(n,r),a}(st.a);function xt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var Et=function(){function t(e,n){var o,r,i,a=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i=function(){a.offsetBounds=At(a.elements).map((function(t){return Ot(t,a.offsetContainer)}))},(r="recompute")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,this.elements=e,this.offsetContainer=n,this.recompute()}var e,n,o;return e=t,(n=[{key:"rects",get:function(){return this.offsetBounds}},{key:"top",get:function(){return this.offsetBounds[0].top}},{key:"bottom",get:function(){return this.offsetBounds[this.offsetBounds.length-1].bottom}},{key:"height",get:function(){return this.bottom-this.top}},{key:"topHandleXY",get:function(){return[this.offsetBounds[0].left+this.offsetBounds[0].width/2+.5,this.offsetBounds[0].top]}},{key:"bottomHandleXY",get:function(){var t=this.offsetBounds.length-1;return[this.offsetBounds[t].left+this.offsetBounds[t].width/2-.5,this.offsetBounds[t].bottom]}}])&&xt(e.prototype,n),o&&xt(e,o),t}(),Ot=function(t,e){var n=e.getBoundingClientRect(),o=n.x,r=n.y,i=Math.round(t.left-o),a=Math.round(t.top-r);return{left:i,top:a,right:Math.round(i+t.width),bottom:Math.round(a+t.height),width:Math.round(t.width),height:Math.round(t.height)}},At=function(t){var e=t.reduce((function(t,e){for(var n=e.getClientRects(),o=n.length,r=0;r<o;r++)t.push(n[r]);return t}),[]);return St(e)},St=function(t){return 1==t.length?t:t.reduce((function(t,e){var n,o,r=t.length>0?t[t.length-1]:null;return r?(o=e,(n=r).height!==o.height||n.x+n.width!==o.x&&o.x+o.width!==n.x?t.push(e):function(t,e){t.x=Math.min(t.x,e.x),t.left=Math.min(t.left,e.left),t.width=t.width+e.width,t.right=Math.max(t.right+e.right)}(r,e)):t.push(e),t}),[])},Ct={NAMESPACE:"http://www.w3.org/2000/svg",BORDER_RADIUS:3,LINE_DISTANCE:6.5,ARC_0CW:"a3,3 0 0 1 3,3",ARC_0CC:"a3,3 0 0 0 -3,3",ARC_3CW:"a3,3 0 0 1 -3,3",ARC_3CC:"a3,3 0 0 0 -3,-3",ARC_6CW:"a3,3 0 0 1 -3,-3",ARC_6CC:"a3,3 0 0 0 3,-3",ARC_9CW:"a3,3 0 0 1 3,-3",ARC_9CC:"a3,3 0 0 0 3,3"};function jt(t){return(jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _t(t,e){return!e||"object"!==jt(e)&&"function"!=typeof e?kt(t):e}function kt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Rt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Pt(t){return(Pt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Dt(t,e){return(Dt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Nt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Mt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Dt(t,e)}(o,t);var e,n=(e=o,function(){var t,n=Pt(e);if(Rt()){var o=Pt(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return _t(this,t)});function o(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),Nt(kt(r=n.call(this)),"setPosition",(function(t,e){var n=Math.round(t[0])-.5,o=Math.round(t[1]),i=Math.round(r.bounds.width/2);r.rect.setAttribute("x",n-3-i),r.rect.setAttribute("y",o-6.5),r.text.setAttribute("x",n),r.text.setAttribute("y",o),r.arrow.setAttribute("d","left"===e?"M"+(t[0]-i-8)+","+(t[1]-4)+"l-7,4l7,4":"right"===e?"M"+(t[0]+i+8)+","+(t[1]-4)+"l7,4l-7,4":"down"===e?"M"+(t[0]-4)+","+(t[1]+12)+"l4,7l4,-7":"M"+(t[0]-4)+","+(t[1]-12)+"l4,-7l4,7")})),Nt(kt(r),"destroy",(function(){return r.svg.removeChild(r.g)})),r.svg=e,r.g=document.createElementNS(Ct.NAMESPACE,"g"),r.text=document.createElementNS(Ct.NAMESPACE,"text"),r.rect=document.createElementNS(Ct.NAMESPACE,"rect"),r.arrow=document.createElementNS(Ct.NAMESPACE,"path"),r.g.appendChild(r.rect),r.g.appendChild(r.text),r.g.appendChild(r.arrow),r.svg.appendChild(r.g),r.g.setAttribute("class","handle"),r.text.innerHTML=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),r.bounds=r.text.getBBox(),r.text.setAttribute("dy",2),r.text.setAttribute("dx",-Math.round(r.bounds.width/2)),r.rect.setAttribute("rx",2),r.rect.setAttribute("ry",2),r.rect.setAttribute("width",Math.round(r.bounds.width)+5),r.rect.setAttribute("height",Math.round(r.bounds.height)),r.arrow.setAttribute("class","arrow"),r.rect.addEventListener("click",(function(){return r.emit("click")})),r}return o}(st.a),Tt=function(t,e){var n=t.querySelectorAll('*[data-id="'.concat(e,'"]'));return n.length>0?{annotation:n[0].annotation,elements:Array.from(n)}:null},Bt=function(t){var e,n=t.target.closest(".r6o-annotation");if(n){var o=Lt(n),r=(e=o.map((function(t){return t.annotation})),e.sort((function(t,e){return t.quote.length-e.quote.length})))[0],i=document.querySelectorAll('.r6o-annotation[data-id="'.concat(r.id,'"]'));return{annotation:r,elements:Array.from(i)}}},Lt=function t(e,n){var o=n||[];o.push(e);var r=e.parentNode;return r.classList.contains("r6o-annotation")?t(r,o):o};function It(t){return(It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ut(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],o=!0,r=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(o=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(t){r=!0,i=t}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return zt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function Ht(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function qt(t,e){return!e||"object"!==It(e)&&"function"!=typeof e?Xt(t):e}function Xt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Yt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Wt(t){return(Wt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ft(t,e){return(Ft=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Kt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var $t=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ft(t,e)}(a,t);var e,n,o,r,i=(e=a,function(){var t,n=Wt(e);if(Yt()){var o=Wt(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return qt(this,t)});function a(t,e,n){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),Kt(Xt(o=i.call(this)),"initFromAnnotation",(function(t,e,n){var o=this,r=Ut(n.target.map((function(t){return t.id})),2),i=r[0],a=r[1],c=n.bodies[0].value,u=Tt(t,i),l=new Et(u.elements,e),s=Tt(t,a),f=new Et(s.elements,e),d=s,p=new Mt(c,e);return p.on("click",(function(){return o.emit("click",{annotation:n,from:u.annotation,to:s.annotation,midX:o.currentMidXY[0],midY:o.currentMidXY[1]})})),{annotation:n,fromNode:u,fromBounds:l,toNode:s,toBounds:f,currentEnd:d,handle:p,floating:!1}})),Kt(Xt(o),"initFromStartNode",(function(t,e){return{fromNode:e,fromBounds:new Et(e.elements,t),floating:!0}})),Kt(Xt(o),"unfloat",(function(){this.currentEnd.elements&&(this.floating=!1)})),Kt(Xt(o),"dragTo",(function(t){this.floating&&(this.currentEnd=t,t.elements&&(this.toNode=t,this.toBounds=new Et(t.elements,this.svgEl)))})),Kt(Xt(o),"destroy",(function(){o.svgEl.removeChild(o.path),o.svgEl.removeChild(o.startDot),o.svgEl.removeChild(o.endDot),o.handle&&o.handle.destroy()})),Kt(Xt(o),"redraw",(function(){if(this.currentEnd){var t,e=this.endXY,n=e[1]<=this.fromBounds.top+this.fromBounds.height/2,o=n?this.fromBounds.topHandleXY:this.fromBounds.bottomHandleXY,r=e[0]-o[0],i=e[1]-o[1],a=(Math.abs(r)+Math.abs(i))/2,c=a>Math.abs(r)?o[0]+r:o[0]+a*Math.sign(r),u=a>Math.abs(r)?i>0?"down":"up":r>0?"right":"left",l=Ct.LINE_DISTANCE-Ct.BORDER_RADIUS;this.startDot.setAttribute("cx",o[0]),this.startDot.setAttribute("cy",o[1]),this.startDot.setAttribute("r",2),this.startDot.setAttribute("class","start"),this.endDot.setAttribute("cx",e[0]),this.endDot.setAttribute("cy",e[1]),this.endDot.setAttribute("r",2),this.endDot.setAttribute("class","end"),n?this.path.setAttribute("d",(s=r>0?Ct.ARC_9CW:Ct.ARC_3CC,f=r>0?i>=0?Ct.ARC_0CW:Ct.ARC_6CC:i>=0?Ct.ARC_0CC:Ct.ARC_6CW,t=a>Math.abs(r)?o[1]-(a-Math.abs(r))-Ct.LINE_DISTANCE:o[1]-Ct.LINE_DISTANCE,"M"+o[0]+" "+o[1]+"v-"+(Ct.LINE_DISTANCE-Ct.BORDER_RADIUS)+s+"h"+(r-2*Math.sign(r)*Ct.BORDER_RADIUS)+f+"V"+e[1])):this.path.setAttribute("d",function(){var n=r>0?Ct.ARC_9CC:Ct.ARC_3CW,i=r>0?Ct.ARC_0CW:Ct.ARC_0CC;return t=a>Math.abs(r)?o[1]+a-Math.abs(r)+Ct.LINE_DISTANCE:o[1]+Ct.LINE_DISTANCE,"M"+o[0]+" "+o[1]+"v"+l+n+"h"+(r-2*Math.sign(r)*Ct.BORDER_RADIUS)+i+"V"+e[1]}()),this.path.setAttribute("class","connection"),this.currentMidXY=[c,t],this.handle&&this.handle.setPosition(this.currentMidXY,u)}var s,f})),Kt(Xt(o),"recompute",(function(){o.fromBounds.recompute(),o.currentEnd.elements&&o.toBounds.recompute(),o.redraw()})),Kt(Xt(o),"matchesRelation",(function(t){return t.from.isEqual(o.fromNode.annotation)&&t.to.isEqual(o.toNode.annotation)})),o.svgEl=e,o.path=document.createElementNS(Ct.NAMESPACE,"path"),o.startDot=document.createElementNS(Ct.NAMESPACE,"circle"),o.endDot=document.createElementNS(Ct.NAMESPACE,"circle"),e.appendChild(o.path),e.appendChild(o.startDot),e.appendChild(o.endDot);var r="Annotation"===n.type?o.initFromAnnotation(t,e,n):o.initFromStartNode(e,n);return o.annotation=r.annotation,o.fromNode=r.fromNode,o.fromBounds=r.fromBounds,o.toNode=r.toNode,o.toBounds=r.toBounds,o.currentEnd=r.currentEnd,o.handle=r.handle,o.floating=r.floating,o.redraw(),o}return n=a,(o=[{key:"isFloating",get:function(){return this.floating}},{key:"startAnnotation",get:function(){return this.fromNode.annotation}},{key:"endAnnotation",get:function(){return this.toNode.annotation}},{key:"endXY",get:function(){return this.currentEnd instanceof Array?this.currentEnd:this.fromBounds.top>this.toBounds.top?this.toBounds.bottomHandleXY:this.toBounds.topHandleXY}},{key:"midXY",get:function(){return this.currentMidXY}}])&&Ht(n.prototype,o),r&&Ht(n,r),a}(st.a);var Vt=function t(e,n){var o,r,i,a=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i=function(){a.svgEl.removeChild(a.outlines)},(r="destroy")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,this.annotation=n[0].annotation,this.node={annotation:this.annotation,elements:n},this.outlines=document.createElementNS(Ct.NAMESPACE,"g"),new Et(n,e).rects.forEach((function(t){var e=document.createElementNS(Ct.NAMESPACE,"rect");e.setAttribute("x",t.left-.5),e.setAttribute("y",t.top-.5),e.setAttribute("width",t.width+1),e.setAttribute("height",t.height),e.setAttribute("class","hover"),a.outlines.appendChild(e)})),e.appendChild(this.outlines),this.svgEl=e};function Qt(t){return(Qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Jt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],o=!0,r=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(o=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(t){r=!0,i=t}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Gt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Gt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Gt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function Zt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function te(t,e){return!e||"object"!==Qt(e)&&"function"!=typeof e?ee(t):e}function ee(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ne(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function oe(t){return(oe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function re(t,e){return(re=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ie(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ae=function(t,e){return function(n){n.target.matches(t)&&e(n)}},ce=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&re(t,e)}(a,t);var e,n,o,r,i=(e=a,function(){var t,n=oe(e);if(ne()){var o=oe(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return te(this,t)});function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),ie(ee(n=i.call(this)),"attachHandlers",(function(){n.contentEl.classList.add("noselect"),n.contentEl.addEventListener("mousedown",n.onMouseDown),n.contentEl.addEventListener("mousemove",n.onMouseMove),n.contentEl.addEventListener("mouseup",n.onMouseUp),n.contentEl.addEventListener("mouseover",n.onEnterAnnotation),n.contentEl.addEventListener("mouseout",n.onLeaveAnnotation),document.addEventListener("keydown",n.onKeyDown)})),ie(ee(n),"detachHandlers",(function(){n.contentEl.classList.remove("noselect"),n.contentEl.removeEventListener("mousedown",n.onMouseDown),n.contentEl.removeEventListener("mousemove",n.onMouseMove),n.contentEl.removeEventListener("mouseup",n.onMouseUp),n.contentEl.removeEventListener("mouseover",n.onEnterAnnotation),n.contentEl.removeEventListener("mouseleave",n.onLeaveAnnotation),document.removeEventListener("keydown",n.onKeyDown)})),ie(ee(n),"onMouseDown",(function(t){var e=Bt(t);e&&(n.currentConnection?n.completeConnection(e):n.startNewConnection(e))})),ie(ee(n),"onMouseMove",(function(t){if(n.currentConnection&&n.currentConnection.isFloating)if(n.currentHover)n.currentConnection.dragTo(n.currentHover.node);else{var e=n.contentEl.getBoundingClientRect(),o=e.x,r=e.y;n.currentConnection.dragTo([t.pageX-o,t.pageY-r])}})),ie(ee(n),"onMouseUp",(function(){n.currentHover&&n.currentConnection&&n.currentConnection.isFloating&&n.currentHover.annotation!==n.currentConnection.startAnnotation&&n.completeConnection(n.currentHover.node)})),ie(ee(n),"onKeyDown",(function(t){27===t.which&&(n.reset(),n.emit("cancelDrawing"))})),ie(ee(n),"onEnterAnnotation",ae(".r6o-annotation",(function(t){n.currentHover&&n.hover(),n.hover(Bt(t).elements)}))),ie(ee(n),"onLeaveAnnotation",ae(".r6o-annotation",(function(t){n.hover()}))),ie(ee(n),"hover",(function(t){t?n.currentHover=new Vt(n.svgEl,t):(n.currentHover&&n.currentHover.destroy(),n.currentHover=null)})),ie(ee(n),"startNewConnection",(function(t){n.currentConnection=new $t(n.contentEl,n.svgEl,t),n.contentEl.classList.add("r6o-drawing"),n.render()})),ie(ee(n),"completeConnection",(function(){this.currentConnection.unfloat(),this.contentEl.classList.remove("r6o-drawing");var t=this.currentConnection.startAnnotation,e=this.currentConnection.endAnnotation,n=Jt(this.currentConnection.midXY,2),o=n[0],r=n[1],i=V.create({target:[{id:t.id},{id:e.id}]});this.emit("createRelation",{annotation:i,from:t,to:e,midX:o,midY:r})})),ie(ee(n),"reset",(function(){n.currentConnection&&(n.currentConnection.destroy(),n.currentConnection=null,n.contentEl.classList.remove("r6o-drawing"))})),ie(ee(n),"render",(function(){n.currentConnection&&(n.currentConnection.redraw(),requestAnimationFrame(n.render))})),n.contentEl=t,n.svgEl=e,n.currentHover=null,n.currentConnection=null,n}return n=a,(o=[{key:"enabled",set:function(t){t?this.attachHandlers():(this.detachHandlers(),this.contentEl.classList.remove("r6o-drawing"),this.currentConnection&&(this.currentConnection.destroy(),this.currentConnection=null))}}])&&Zt(n.prototype,o),r&&Zt(n,r),a}(st.a);n(52);function ue(t){return(ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function le(t){return function(t){if(Array.isArray(t))return se(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return se(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return se(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function se(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function fe(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function de(t,e){return!e||"object"!==ue(e)&&"function"!=typeof e?pe(t):e}function pe(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function he(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function be(t){return(be=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ye(t,e){return(ye=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function me(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ge=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ye(t,e)}(a,t);var e,n,o,r,i=(e=a,function(){var t,n=be(e);if(he()){var o=be(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return de(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),me(pe(e=i.call(this)),"createConnection",(function(t){var n=new $t(e.contentEl,e.svg,t);return n.on("click",(function(t){return e.emit("selectRelation",t)})),n})),me(pe(e),"init",(function(t){e.connections=t.filter((function(t){return t.targets.every((function(t){return t.id&&t.id.startsWith("#")}))&&"linking"===t.motivation})).reduce((function(t,n){try{var o=e.createConnection(n);return[].concat(le(t),[o])}catch(e){return console.log(e),console.log("Error rendering relation for annotation ".concat(n.id)),t}}),[])})),me(pe(e),"recomputeAll",(function(){e.connections.forEach((function(t){t.recompute()}))})),me(pe(e),"addOrUpdateRelation",(function(t,n){var o=n?e.connections.find((function(e){return e.matchesRelation(t)})):null;if(o)e.connections=e.connections.map((function(n){return n==o?(n.destroy(),e.createConnection(t.annotation)):n}));else{var r=e.createConnection(t.annotation);e.connections.push(r)}})),me(pe(e),"removeRelation",(function(t){var n=e.connections.find((function(e){return e.matchesRelation(t)}));n&&(e.connections=e.connections.filter((function(t){return t!==n})),n.destroy())})),me(pe(e),"getAllRelations",(function(){return e.connections.map((function(t){return t.annotation}))})),me(pe(e),"getConnectionsFor",(function(t){return e.connections.filter((function(e){return e.startAnnotation.isEqual(t)||e.endAnnotation.isEqual(t)}))})),me(pe(e),"show",(function(){return e.svg.style.display="inital"})),me(pe(e),"hide",(function(){e.drawingEnabled=!1,e.svg.style.display="none"})),me(pe(e),"startDrawing",(function(){return e.drawingTool.enabled=!0})),me(pe(e),"stopDrawing",(function(){return e.drawingTool.enabled=!1})),me(pe(e),"resetDrawing",(function(){return e.drawingTool.reset()})),e.connections=[],e.contentEl=t,e.svg=document.createElementNS(Ct.NAMESPACE,"svg"),e.svg.classList.add("r6o-relations-layer"),e.contentEl.appendChild(e.svg),e.drawingTool=new ce(t,e.svg),e.drawingTool.on("createRelation",(function(t){return e.emit("createRelation",t)})),e.drawingTool.on("cancelDrawing",(function(){return e.emit("cancelDrawing")})),window.addEventListener("resize",e.recomputeAll),e}return n=a,(o=[{key:"readOnly",get:function(){this.svg.classList.contains("readonly")},set:function(t){t?this.svg.classList.add("readonly"):this.svg.classList.remove("readonly")}}])&&fe(n.prototype,o),r&&fe(n,r),a}(st.a);function ve(t){return(ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function we(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function xe(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function Ee(t,e){return!e||"object"!==ve(e)&&"function"!=typeof e?Oe(t):e}function Oe(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ae(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Se(t){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ce(t,e){return(Ce=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function je(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var _e=function(t){var e=t.annotation.bodies.find((function(t){return"tagging"===t.purpose}));return e?e.value:""},ke=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ce(t,e)}(c,t);var e,n,o,i,a=(e=c,function(){var t,n=Se(e);if(Ae()){var o=Se(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return Ee(this,t)});function c(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),je(Oe(e=a.call(this,t)),"onChange",(function(t){return e.setState({content:t.target.value})})),je(Oe(e),"onKeyDown",(function(t){13===t.which?(t.preventDefault(),e.onSubmit()):27===t.which&&e.props.onCancel()})),je(Oe(e),"onSubmit",(function(){var t=e.props.relation.annotation.clone({body:[{type:"TextualBody",value:e.state.content,purpose:"tagging"}]}),n=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?we(Object(n),!0).forEach((function(e){je(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):we(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},e.props.relation,{annotation:t});e.props.onRelationUpdated(n,e.props.relation)})),je(Oe(e),"onDelete",(function(){return e.props.onRelationDeleted(e.props.relation)})),e.state={content:_e(t.relation)},e.element=r.a.createRef(),e}return n=c,(o=[{key:"componentDidMount",value:function(){this.setPosition()}},{key:"componentDidUpdate",value:function(){this.setPosition()}},{key:"componentWillReceiveProps",value:function(t){this.props.relation!==t.relation&&this.setState({content:_e(t.relation)})}},{key:"setPosition",value:function(){if(this.element.current){var t=this.element.current,e=this.props.relation,n=e.midX,o=e.midY;t.style.top="".concat(o,"px"),t.style.left="".concat(n,"px"),setTimeout((function(){return t.querySelector(".input").focus()}),0)}}},{key:"render",value:function(){return r.a.createElement("div",{className:"r6o-relation-editor",ref:this.element},r.a.createElement(g.a,{className:"input",html:this.state.content,"data-placeholder":"Tag...",onChange:this.onChange,onKeyDown:this.onKeyDown}),r.a.createElement("div",{className:"buttons"},r.a.createElement("span",{className:"icon delete",onClick:this.onDelete},"ï€”"),r.a.createElement("span",{className:"icon ok",onClick:this.onSubmit},"ï€Œ")))}}])&&xe(n.prototype,o),i&&xe(n,i),c}(o.Component);function Re(t){return(Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function De(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function Ne(t,e){return!e||"object"!==Re(e)&&"function"!=typeof e?Me(t):e}function Me(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Te(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Be(t){return(Be=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Le(t,e){return(Le=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ie(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ue=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Le(t,e)}(c,t);var e,n,o,i,a=(e=c,function(){var t,n=Be(e);if(Te()){var o=Be(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return Ne(this,t)});function c(){var t;Pe(this,c);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return Ie(Me(t=a.call.apply(a,[this].concat(n))),"state",{showEditor:!1,selectionBounds:null,selectedAnnotation:null,showRelationEditor:!1,selectedRelation:null}),Ie(Me(t),"_clearState",(function(){t.setState({showEditor:!1,selectionBounds:null,selectedAnnotation:null})})),Ie(Me(t),"handleEscape",(function(e){27===e.which&&t.onCancelAnnotation()})),Ie(Me(t),"handleSelect",(function(e){var n=e.selection,o=e.clientRect;n?t.setState({showEditor:!0,selectionBounds:o,selectedAnnotation:n}):t._clearState()})),Ie(Me(t),"onCreateOrUpdateAnnotation",(function(e){return function(n,o){t._clearState(),t.selectionHandler.clearSelection(),t.highlighter.addOrUpdateAnnotation(n,o),t.props[e](n,o)}})),Ie(Me(t),"onDeleteAnnotation",(function(e){t.relationsLayer.getConnectionsFor(e).forEach((function(t){return t.destroy()})),t._clearState(),t.selectionHandler.clearSelection(),t.highlighter.removeAnnotation(e)})),Ie(Me(t),"onCancelAnnotation",(function(){t._clearState(),t.selectionHandler.clearSelection()})),Ie(Me(t),"closeRelationsEditor",(function(){t.setState({showRelationEditor:!1}),t.relationsLayer.resetDrawing()})),Ie(Me(t),"onEditRelation",(function(e){t.setState({showRelationEditor:!0,selectedRelation:e})})),Ie(Me(t),"onCreateOrUpdateRelation",(function(e,n){t.relationsLayer.addOrUpdateRelation(e,n),t.closeRelationsEditor()})),Ie(Me(t),"onDeleteRelation",(function(e){t.relationsLayer.removeRelation(e),t.closeRelationsEditor()})),Ie(Me(t),"addAnnotation",(function(e){t.highlighter.addOrUpdateAnnotation(e)})),Ie(Me(t),"removeAnnotation",(function(e){t.highlighter.removeAnnotation(e);var n=t.state.selectedAnnotation;n&&e.isEqual(n)&&t.setState({showEditor:!1})})),Ie(Me(t),"setAnnotations",(function(e){t.highlighter.init(e),t.relationsLayer.init(e)})),Ie(Me(t),"getAnnotations",(function(){var e=t.highlighter.getAllAnnotations(),n=t.relationsLayer.getAllRelations();return e.concat(n)})),Ie(Me(t),"setMode",(function(e){"RELATIONS"===e?(t.setState({showEditor:!1}),t.selectionHandler.enabled=!1,t.relationsLayer.readOnly=!1,t.relationsLayer.startDrawing()):(t.setState({showRelationEditor:!1}),t.selectionHandler.enabled=!0,t.relationsLayer.readOnly=!0,t.relationsLayer.stopDrawing())})),t}return n=c,(o=[{key:"componentDidMount",value:function(){this.highlighter=new et(this.props.contentEl,this.props.formatter),this.selectionHandler=new wt(this.props.contentEl,this.highlighter),this.selectionHandler.on("select",this.handleSelect),this.relationsLayer=new ge(this.props.contentEl),this.relationsLayer.readOnly=!0,this.relationsLayer.on("createRelation",this.onEditRelation),this.relationsLayer.on("selectRelation",this.onEditRelation),this.relationsLayer.on("cancelDrawing",this.closeRelationsEditor),document.addEventListener("keydown",this.handleEscape)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleEscape)}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,this.state.showEditor&&r.a.createElement(Y,{open:this.state.showEditor,readOnly:this.props.readOnly,bounds:this.state.selectionBounds,containerEl:this.props.containerEl,annotation:this.state.selectedAnnotation,onAnnotationCreated:this.onCreateOrUpdateAnnotation("onAnnotationCreated"),onAnnotationUpdated:this.onCreateOrUpdateAnnotation("onAnnotationUpdated"),onAnnotationDeleted:this.onDeleteAnnotation,onCancel:this.onCancelAnnotation},this.props.children),this.state.showRelationEditor&&r.a.createElement(ke,{relation:this.state.selectedRelation,onRelationUpdated:this.onCreateOrUpdateRelation,onRelationDeleted:this.onDeleteRelation,onCancel:this.closeRelationsEditor}))}}])&&De(n.prototype,o),i&&De(n,i),c}(o.Component);function ze(t){return function(t){if(Array.isArray(t))return He(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return He(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return He(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function He(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}Y.CommentWidget=I,Y.TagWidget=b;var qe=function t(e){e.forEach((function(t){var e=function(t){return Array.from(t.childNodes).reduce((function(t,e){if(e.nodeType===Node.TEXT_NODE){if(e.textContent.trim().length>0){var n=e.textContent.replace(/\s\s+/g," ");return[].concat(ze(t),[document.createTextNode(n)])}return t}return[].concat(ze(t),[e])}),[])}(t);t.innerHTML="",e.forEach((function(e){return t.appendChild(e)}))}));var n=e.reduce((function(t,e){return t.concat(Array.from(e.childNodes).filter((function(t){return t.firstChild})))}),[]);n.length>0&&t(n)};n(54);function Xe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ye=function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Xe(this,"handleAnnotationCreated",(function(t){return n._emitter.emit("createAnnotation",t)})),Xe(this,"handleAnnotationUpdated",(function(t,e){return n._emitter.emit("updateAnnotation",t,e)})),Xe(this,"handleAnnotationDeleted",(function(t){return n._emitter.emit("deleteAnnotation",t)})),Xe(this,"addAnnotation",(function(t){return n._app.current.addAnnotation(new V(t))})),Xe(this,"removeAnnotation",(function(t){return n._app.current.removeAnnotation(new V(t))})),Xe(this,"loadAnnotations",(function(t){return u.a.get(t).then((function(t){var e=t.data.map((function(t){return new V(t)}));return n._app.current.setAnnotations(e),e}))})),Xe(this,"getAnnotations",(function(){return n._app.current.getAnnotations()})),Xe(this,"setMode",(function(t){return n._app.current.setMode(t)})),Xe(this,"on",(function(t,e){return n._emitter.on(t,e)})),Xe(this,"off",(function(t,e){return n._emitter.off(t,e)})),this._app=r.a.createRef(),this._emitter=new s.a;var o,i=e.content.nodeType?e.content:document.getElementById(e.content);"pre"!==e.mode&&(qe([o=i]),i=o);var c=document.createElement("DIV");c.style.position="relative",i.parentNode.insertBefore(c,i),c.appendChild(i);var l=document.createElement("DIV");c.appendChild(l);var f=Y.CommentWidget,d=Y.TagWidget;a.a.render(r.a.createElement(Ue,{ref:this._app,contentEl:i,containerEl:c,readOnly:e.readOnly,formatter:e.formatter,onAnnotationCreated:this.handleAnnotationCreated,onAnnotationUpdated:this.handleAnnotationUpdated,onAnnotationDeleted:this.handleAnnotationDeleted},r.a.createElement(f,null),r.a.createElement(d,null)),l)},We=function(t){return new Ye(t)}}})}));